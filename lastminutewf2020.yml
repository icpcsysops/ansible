---
- hosts: all
  roles:
    - role: stuvusIT.systemd-timesyncd
      timesync_timezone: "{{ timezone }}"
      timesync_ntp_hosts:
         - "{{ baseip }}.208"
         - "{{ baseip }}.209"
         - "{{ baseip }}.210"
      timesync_fallback_ntp_hosts:
        - "{{ baseip }}.208"
        - "{{ baseip }}.209"
        - "{{ baseip }}.210"
      tags: systemd-timesyncd
- hosts: contestants
  roles:
    - role: cups
    - role: ldapclient
      tags: ldapclient
- hosts: ldapserver
  roles:
    - role: ldapserver
      tags: ldapserver
- hosts: all:!backup
  tasks:
    - name: point rsyslog to backup
      ansible.builtin.copy:
        content: |
          # ship the important logs to backup
          kern.warning                    @backup
          auth,authpriv.*                 @backup
        dest: /etc/rsyslog.d/70-clients.conf
        owner: root
        group: root
        mode: '0644'
- hosts: all
  tasks:
    - name: Ensure scoreboard in /etc/hosts
      ansible.builtin.lineinfile:
        path: /etc/hosts
        line: "{{ baseip }}.208	scoreboard"
        owner: root
        group: root
        mode: '0644'
    - name: Ensure packages in /etc/hosts
      ansible.builtin.lineinfile:
        path: /etc/hosts
        line: "{{ baseip }}.209	packages"
        owner: root
        group: root
        mode: '0644'
    - name: Ensure backup in /etc/hosts
      ansible.builtin.lineinfile:
        path: /etc/hosts
        line: "{{ baseip }}.210	backup"
        owner: root
        group: root
        mode: '0644'
    - name: Ensure printsrv in /etc/hosts
      ansible.builtin.lineinfile:
        path: /etc/hosts
        line: "{{ baseip }}.211	printsrv"
        owner: root
        group: root
        mode: '0644'
    - name: Replace sysopspackages.icpc.global with packages
      ansible.builtin.replace:
        path: /etc/apt/{{ item }}
        regexp: "sysopspackages.icpc.global"
        replace: "packages"
        owner: root
        group: root
        mode: '0644'
      loop:
        - "sources.list"
        - "sources.list.d/mono.list"
        - "sources.list.d/pypy-ubuntu-ppa-buster.list"
    - name: Log version of script on client
      community.general.syslogger:
        ident: "lastminute"
        msg: "Finished {{ version }}"
        priority: "notice"
      changed_when: false

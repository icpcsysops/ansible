---
- name: Configure pc2 machines
  hosts: ccsadmin*,pc2-aj*

  roles:
    - role: hyperthreadingdisabled

  tasks:
    - name: Create ~icpc2023/.ssh if it does not exist
      ansible.builtin.file:
        path: /home/icpc2023/.ssh
        state: directory
        mode: "0700"
        group: icpc2023
        owner: icpc2023

    - name: Copy authorized_keys2 to icpc
      ansible.posix.authorized_key:
        user: icpc2023
        state: present
        key: "{{ lookup('file', 'files/pc2.authorized_keys2') }}"

- name: Configure wf46 pc2 machines
  hosts: pc2server-wf46,ccsadmin[1-4]

  roles:
    - role: pc2client

- name: Configure wf47 pc2 machines
  hosts: pc2server-wf47,ccsadmin[5-8]
  vars:
    pc2server: 10.3.3.221

  roles:
    - role: pc2client

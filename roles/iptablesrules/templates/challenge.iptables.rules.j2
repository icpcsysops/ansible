# Generated by iptables-save v1.8.4 on Tue Nov  8 08:42:32 2022
*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
:NETAVARK_FORWARD - [0:0]
:accept-in-log - [0:0]
:accept-out-log - [0:0]
:drop-n-log - [0:0]

-A FORWARD -m comment --comment "netavark firewall plugin rules" -j NETAVARK_FORWARD
-A NETAVARK_FORWARD -d 10.88.0.0/16 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A NETAVARK_FORWARD -s 10.88.0.0/16 -j ACCEPT

-A INPUT -s 10.88.0.0/16 -j ACCEPT
-A OUTPUT -d 10.88.0.0/16 -j ACCEPT

-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -s 10.3.3.215/32 -p tcp -m tcp --sport 443 -j ACCEPT
-A INPUT -s 10.3.3.209/32 -p tcp -m tcp --sport 443 -j ACCEPT
-A INPUT -s 10.3.3.208/32 -p tcp -m tcp --sport 123 -j ACCEPT
-A INPUT -s 10.3.3.208/32 -p udp -m udp --sport 123 -j ACCEPT
-A INPUT -s 10.3.3.209/32 -p tcp -m tcp --sport 123 -j ACCEPT
-A INPUT -s 10.3.3.209/32 -p udp -m udp --sport 123 -j ACCEPT
-A INPUT -s 10.3.3.210/32 -p tcp -m tcp --sport 123 -j ACCEPT
-A INPUT -s 10.3.3.210/32 -p udp -m udp --sport 123 -j ACCEPT
-A INPUT -s 10.3.3.254/32 -p tcp -m tcp --sport 123 -j ACCEPT
-A INPUT -s 10.3.3.254/32 -p udp -m udp --sport 123 -j ACCEPT
-A INPUT -s 10.3.3.207/32 -p tcp -m tcp --sport 443 -j ACCEPT
-A INPUT -s 10.3.3.207/32 -p tcp -m tcp --sport 9443 -j ACCEPT
-A INPUT -s 10.3.3.208/29 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 10.3.3.205/32 -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT -s 10.3.3.207/32 -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT -s 10.3.3.208/28 -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT -s 10.3.3.205/32 -p tcp -m tcp --dport 9090 -j ACCEPT
-A INPUT -s 10.3.3.207/32 -p tcp -m tcp --dport 9090 -j ACCEPT
-A INPUT -s 10.3.3.208/28 -p tcp -m tcp --dport 9090 -j ACCEPT

-A INPUT -s 10.3.3.205/32 -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -s 10.3.3.205/32 -p tcp -m tcp --dport 443 -j ACCEPT

-A INPUT -s 10.3.3.213/32 -p tcp -m tcp --sport 22 -j ACCEPT
-A INPUT -s 10.3.3.210/32 -p tcp -m tcp --sport 22 -j ACCEPT
-A INPUT -s 10.3.3.208/29 -p udp -m udp --sport 514 -j ACCEPT
-A INPUT -s 10.3.3.149/32 -p tcp -m tcp --sport 631 -j ACCEPT
-A INPUT -s 10.3.3.149/32 -p udp -m udp --sport 631 -j ACCEPT
-A INPUT -s 10.3.3.208/32 -p tcp -m tcp --sport 631 -j ACCEPT
-A INPUT -s 10.3.3.208/32 -p udp -m udp --sport 631 -j ACCEPT
-A INPUT -s 10.3.3.216/32 -p udp -m udp --sport 515 -j ACCEPT
-A INPUT -s 10.3.3.216/32 -p tcp -m tcp --sport 515 -j ACCEPT
-A INPUT -s 10.3.3.210/31 -p tcp -m tcp --sport 389 -j ACCEPT
-A INPUT -s 10.3.3.210/31 -p tcp -m tcp --sport 636 -j ACCEPT
-A INPUT -s 10.3.3.208/29 -p icmp -m icmp --icmp-type 8 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 8 -m state --state NEW,RELATED,ESTABLISHED -j drop-n-log
-A INPUT -s 10.3.3.210/32 -p icmp -m icmp --icmp-type 3 -j ACCEPT
-A INPUT -j drop-n-log
-A OUTPUT -p udp -m multiport --dports 53 -j ACCEPT
-A OUTPUT -p tcp -m multiport --dports 80,443,53 -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -p udp -m udp --dport 137 -j REJECT --reject-with icmp-port-unreachable
-A OUTPUT -p udp -m udp --dport 1124 -j REJECT --reject-with icmp-port-unreachable
-A OUTPUT -p udp -m udp --dport 3289 -j REJECT --reject-with icmp-port-unreachable
-A OUTPUT -p udp -m udp --dport 5353 -j REJECT --reject-with icmp-port-unreachable
-A OUTPUT -p udp -m udp --dport 8610 -j REJECT --reject-with icmp-port-unreachable
-A OUTPUT -p udp -m udp --dport 8612 -j REJECT --reject-with icmp-port-unreachable
-A OUTPUT -d 10.3.3.215/32 -p tcp -m tcp --dport 443 -j ACCEPT
-A OUTPUT -d 10.3.3.209/32 -p tcp -m tcp --dport 443 -j ACCEPT
-A OUTPUT -d 10.3.3.208/32 -p tcp -m tcp --dport 123 -j ACCEPT
-A OUTPUT -d 10.3.3.208/32 -p udp -m udp --dport 123 -j ACCEPT
-A OUTPUT -d 10.3.3.209/32 -p tcp -m tcp --dport 123 -j ACCEPT
-A OUTPUT -d 10.3.3.209/32 -p udp -m udp --dport 123 -j ACCEPT
-A OUTPUT -d 10.3.3.210/32 -p tcp -m tcp --dport 123 -j ACCEPT
-A OUTPUT -d 10.3.3.210/32 -p udp -m udp --dport 123 -j ACCEPT
-A OUTPUT -d 10.3.3.254/32 -p tcp -m tcp --dport 123 -j ACCEPT
-A OUTPUT -d 10.3.3.254/32 -p udp -m udp --dport 123 -j ACCEPT
-A OUTPUT -d 10.3.3.207/32 -p tcp -m tcp --dport 443 -j ACCEPT
-A OUTPUT -d 10.3.3.207/32 -p tcp -m tcp --dport 9443 -j ACCEPT
-A OUTPUT -d 10.3.3.208/29 -p tcp -m tcp --sport 22 -j ACCEPT
-A OUTPUT -d 10.3.3.205/32 -p tcp -m tcp --sport 8080 -j ACCEPT
-A OUTPUT -d 10.3.3.207/32 -p tcp -m tcp --sport 8080 -j ACCEPT
-A OUTPUT -d 10.3.3.208/28 -p tcp -m tcp --sport 8080 -j ACCEPT
-A OUTPUT -d 10.3.3.205/32 -p tcp -m tcp --sport 9090 -j ACCEPT
-A OUTPUT -d 10.3.3.207/32 -p tcp -m tcp --sport 9090 -j ACCEPT
-A OUTPUT -d 10.3.3.208/28 -p tcp -m tcp --sport 9090 -j ACCEPT

-A OUTPUT -d 10.3.3.205/32 -p tcp -m tcp --sport 80 -j ACCEPT
-A OUTPUT -d 10.3.3.205/32 -p tcp -m tcp --sport 443 -j ACCEPT

-A OUTPUT -d 10.3.3.213/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A OUTPUT -d 10.3.3.210/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A OUTPUT -d 10.3.3.208/29 -p udp -m udp --dport 514 -j ACCEPT
-A OUTPUT -d 10.3.3.149/32 -p tcp -m tcp --dport 631 -j ACCEPT
-A OUTPUT -d 10.3.3.149/32 -p udp -m udp --dport 631 -j ACCEPT
-A OUTPUT -d 10.3.3.211/32 -p tcp -m tcp --dport 631 -j ACCEPT
-A OUTPUT -d 10.3.3.211/32 -p udp -m udp --dport 631 -j ACCEPT
-A OUTPUT -d 10.3.3.216/32 -p udp -m udp --dport 515 -j ACCEPT
-A OUTPUT -d 10.3.3.216/32 -p tcp -m tcp --dport 515 -j ACCEPT
-A OUTPUT -d 10.3.3.210/31 -p tcp -m tcp --dport 389 -j ACCEPT
-A OUTPUT -d 10.3.3.210/31 -p tcp -m tcp --dport 636 -j ACCEPT
-A OUTPUT -d 10.3.3.0/24 -p tcp -m multiport --dports 80,443,53 -j drop-n-log
-A OUTPUT -d 10.3.3.0/24 -p tcp -m multiport --dports 80,443,53 -j drop-n-log
-A OUTPUT -d 10.3.3.208/29 -p icmp -m icmp --icmp-type 0 -m state --state RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -p icmp -m icmp --icmp-type 0 -m state --state RELATED,ESTABLISHED -j drop-n-log
-A OUTPUT -p icmp -m icmp --icmp-type 8 -j drop-n-log
-A OUTPUT -p icmp -j ACCEPT
-A OUTPUT -j drop-n-log
-A accept-in-log -j LOG --log-prefix "accept-in-log:"
-A accept-in-log -j ACCEPT
-A accept-out-log -j LOG --log-prefix "accept-out-log:"
-A accept-out-log -j ACCEPT
-A drop-n-log -m limit --limit 5/min --limit-burst 7 -j LOG --log-prefix "DENIED:"
-A drop-n-log -j DROP
COMMIT

*nat
:PREROUTING ACCEPT [33:5740]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [444:70154]
:POSTROUTING ACCEPT [444:70154]
:NETAVARK-1D8721804F16F - [0:0]
:NETAVARK-DN-1D8721804F16F - [0:0]
:NETAVARK-HOSTPORT-DNAT - [0:0]
:NETAVARK-HOSTPORT-MASQ - [0:0]
:NETAVARK-HOSTPORT-SETMARK - [0:0]

-A PREROUTING -m addrtype --dst-type LOCAL -j NETAVARK-HOSTPORT-DNAT
-A OUTPUT -m addrtype --dst-type LOCAL -j NETAVARK-HOSTPORT-DNAT

-A POSTROUTING -j NETAVARK-HOSTPORT-MASQ
-A POSTROUTING -s 10.88.0.0/16 -j NETAVARK-1D8721804F16F

-A NETAVARK-1D8721804F16F -d 10.88.0.0/16 -j ACCEPT
-A NETAVARK-1D8721804F16F ! -d 224.0.0.0/4 -j MASQUERADE
-A NETAVARK-DN-1D8721804F16F -s 10.88.0.0/16 -d 127.0.0.1/32 -p tcp -m tcp --dport 9292 -j NETAVARK-HOSTPORT-SETMARK
-A NETAVARK-DN-1D8721804F16F -s 127.0.0.1/32 -d 127.0.0.1/32 -p tcp -m tcp --dport 9292 -j NETAVARK-HOSTPORT-SETMARK
-A NETAVARK-DN-1D8721804F16F -d 127.0.0.1/32 -p tcp -m tcp --dport 9292 -j DNAT --to-destination 10.88.0.2:9292
-A NETAVARK-HOSTPORT-DNAT -p tcp -m tcp --dport 9292 -m comment --comment "dnat name: podman id: 5f19cf322ad1228978c945d8564fb524ea2812b55968ff837e241b58fc18ca40" -j NETAVARK-DN-1D8721804F16F
-A NETAVARK-HOSTPORT-MASQ -m comment --comment "netavark portfw masq mark" -m mark --mark 0x2000/0x2000 -j MASQUERADE
-A NETAVARK-HOSTPORT-SETMARK -j MARK --set-xmark 0x2000/0x2000

COMMIT
# Completed on Tue Nov  8 08:42:32 2022
